{% extends 'base_user.html' %}
{% load static i18n %}

{% block title %}{% trans "Return Requests" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/user/rma/return_requests_list.css' %}">
<link rel="stylesheet" href="{% static 'css/user/user_tables.css' %}">
{% endblock %}

{% block content %}
<div class="return-request-container">
    <!-- header  -->
    <div class="wh-header-section">
        <div class="wh-header-left">
          <h1><span>{% trans "Return" %}</span> {% trans "Requests" %}</h1>
          <!-- <p class="subtext">{% trans "Overview of all deliveries and their status" %}</p> -->
        </div>
        <div class="wh-header-right">          
            <a href="#" class="btn-back">
                <i class="bi bi-arrow-left"></i> {% trans "Back" %}
            </a>
        </div>
    </div>

    <!-- table  -->
    <div class="table-scroll-wrapper">
        <div class="table-container">
            <table class="table-content" id="tableContent" >
                <thead>
                    <tr>
                        <th>{% trans "RMA ID" %}</th>
                        <th>{% trans "Delivery No" %}</th>
                        <th>{% trans "Customer" %}</th>
                        <th>{% trans "Reason" %}</th>
                        <th>{% trans "Status" %}</th>
                        <th>{% trans "Action" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in return_requests %}
                    <tr>
                        <td>RMA-{{ r.id }}</td>

                        <td>
                            {% if r.delivery_order %}
                                {{ r.delivery_order.delivery_no }}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>

                        <td>
                            {% if r.sales_order %}
                                {{ r.sales_order.customer_name }}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>

                        <td>{{ r.reason|truncatechars:50 }}</td>

                        <td>
                            {% if r.status == 'requested' %}
                                <span class="status-badge warning">{{ r.get_status_display }}</span>
                            {% elif r.status == 'picking_created' %}
                                <span class="status-badge approved">{{ r.get_status_display }}</span>
                            {% else %}
                                <span class="status-badge pending">{{ r.get_status_display }}</span>
                            {% endif %}
                        </td>

<td>
    <div class="action-buttons">
        <!-- View Button -->
        <a href="{% url 'warehouse_manager:return_picking_detail' r.id %}"
           class="action-btn view">
          {% trans "View" %}
        </a>

        {% if r.status == 'requested' and not r.picking_exists %}
            <a href="{% url 'warehouse_manager:create_return_picking' r.id %}"
               class="action-btn normal">
              {% trans "Create Picking" %}
            </a>
        {% elif r.picking_exists %}
            <div class="table-alert table-alert-info" role="alert">
                <i class="bi bi-info-circle"></i>
                <span>{% trans "Picking already created" %}</span>
            </div>
        {% else %}
            <span class="status-text success">
                {% trans "Picking Created" %}
            </span>
        {% endif %}
    </div>
</td>

                          
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">
                            {% trans "No return requests available." %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- Pagination Controls -->
        <div class="pagination-container" id="tablePagination"></div>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/user/user_tables.js' %}"></script>
{% endblock %}