{% extends 'base.html' %}
{% load static i18n %}

{% block title %}{% trans "Reset Password" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin/reset_password_confirm.css' %}">
<link rel="stylesheet" href="{% static 'css/error_message.css' %}">
{% endblock %}

{% block content %}
<section class="access-section">
    <div class="access-card">

        <h2 class="access-title">
            <span>{% trans "Reset" %}</span> {% trans "Password" %}
        </h2>

        <p class="access-subtitle">
            {% trans "Create a strong new password to secure your account." %}
        </p>

        <form method="post" class="access-form">
          {% csrf_token %}
      
          <!-- New Password -->
          <div class="input-group password-field">
              <label for="{{ form.new_password.id_for_label }}">
                  {% trans "New Password" %}<span class="required-star">*</span>
              </label>
      
              <div class="password-wrapper">
                  {{ form.new_password }}
                  <i class="bi bi-eye-slash-fill toggle-password" data-target="id_new_password"></i>
              </div>
      
              <div class="password-info">
                  <div id="password-rules" class="password-dropdown">
                      <div class="password-hint-header">
                          <p>Password must meet the following requirements</p>
                      </div>
                      <ul>
                          <li>8–20 characters</li>
                          <li>1 uppercase (A–Z)</li>
                          <li>1 lowercase (a–z)</li>
                          <li>1 number (0–9)</li>
                          <li>1 special (@, #, $, %, &)</li>
                          <li>No spaces</li>
                      </ul>
                  </div>
              </div>
          </div>
      
          <!-- Confirm Password -->
          <div class="input-group password-field">
              <label for="{{ form.confirm_password.id_for_label }}">
                  {% trans "Confirm Password" %}<span class="required-star">*</span>
              </label>
      
              <div class="password-wrapper">
                  {{ form.confirm_password }}
                  <i class="bi bi-eye-slash-fill toggle-password" data-target="id_confirm_password"></i>
              </div>
      
              <div class="password-info">
                  <div id="confirm-password-rules" class="password-dropdown">
                      <div class="password-hint-header">
                          <p>Confirm Password Requirement</p>
                      </div>
                      <ul>
                          <li>Must match the password</li>
                      </ul>
                  </div>
              </div>
          </div>
      
          <button type="submit" class="btn-verify">
              {% trans "Reset Password" %}
          </button>
      </form>
      

        <!-- Errors -->
        <div class="error-container">
            {% if form.errors %}
                {% for field in form %}
                    {% for error in field.errors %}
                        <p class="form-error-message error">{{ error }}</p>
                    {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                    <p class="form-error-message error">{{ error }}</p>
                {% endfor %}
            {% endif %}
        </div>

    </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
  
      const passwordField = document.querySelector('input[name="new_password"]');
      const confirmPasswordField = document.querySelector('input[name="confirm_password"]');
  
      const passwordRulesBox = document.getElementById("password-rules");
      const confirmRulesBox = document.getElementById("confirm-password-rules");
  
      const passwordRules = passwordRulesBox.querySelectorAll("li");
      const confirmRule = confirmRulesBox.querySelector("li");
  
      const checks = [
          /.{8,20}/,
          /[A-Z]/,
          /[a-z]/,
          /\d/,
          /[!@#$%^&*(),.?":{}|<>]/,
          /^[^\s]+$/
      ];
  
      const showBox = (box) => box.style.display = "block";
      const hideBox = (box) => setTimeout(() => box.style.display = "none", 200);
  
      passwordField.addEventListener("focus", () => showBox(passwordRulesBox));
      passwordField.addEventListener("blur", () => hideBox(passwordRulesBox));
  
      confirmPasswordField.addEventListener("focus", () => showBox(confirmRulesBox));
      confirmPasswordField.addEventListener("blur", () => hideBox(confirmRulesBox));
  
      passwordField.addEventListener("input", () => {
          const value = passwordField.value;
  
          checks.forEach((regex, index) => {
              if (regex.test(value)) {
                  passwordRules[index].classList.add("valid");
                  passwordRules[index].classList.remove("invalid");
              } else {
                  passwordRules[index].classList.add("invalid");
                  passwordRules[index].classList.remove("valid");
              }
          });
  
          if (confirmPasswordField.value !== "") {
              if (confirmPasswordField.value === value) {
                  confirmRule.classList.add("valid");
                  confirmRule.classList.remove("invalid");
              } else {
                  confirmRule.classList.add("invalid");
                  confirmRule.classList.remove("valid");
              }
          }
      });
  
      confirmPasswordField.addEventListener("input", () => {
          if (
              confirmPasswordField.value === passwordField.value &&
              passwordField.value !== ""
          ) {
              confirmRule.classList.add("valid");
              confirmRule.classList.remove("invalid");
          } else {
              confirmRule.classList.add("invalid");
              confirmRule.classList.remove("valid");
          }
      });
  
  });
  </script>
  
{% endblock %}

{% block scripts %}
<script src="{% static 'js/error_message.js' %}"></script>
<script src="{% static 'js/password_hide.js' %}"></script>

{% endblock %}
