{% extends 'base.html' %}
{% load static i18n %}

{% block title %}{% trans "Admin Registration" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin/admin_register.css' %}">
<link rel="stylesheet" href="{% static 'css/error_message.css' %}">

{% endblock %}

{% block content %}
<div class="register-container">
    <!-- Left Section -->
    <div class="left-section">
        <div class="welcome-box">
            <div class="form-image">
                <img src="{% static 'images/admin-register.png' %}" alt="{% trans 'Welcome Illustration' %}">
            </div>
            <h2>{% trans "Welcome" %}<span>{% trans " Aboard" %}</span></h2>
            <p>{% trans "Lead with vision," %}<br>{% trans "and build with purpose." %}</p>
        </div>
    </div>

    <!-- Right Section (Form) -->
    <div class="right-section">
        <div class="form-card">
            <div class="form-header">
                <h1>{% trans "Admin" %} <span>{% trans "Registration" %}</span></h1>
            </div>

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="input-grid">

                    <!-- Username -->
                    <div class="form-group">
                        <label for="{{ form.username.id_for_label }}">{% trans "Username" %}<span class="required-star">*</span></label>
                        {{ form.username }}
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="{{ form.email.id_for_label }}">{% trans "Email" %}<span class="required-star">*</span></label>
                        {{ form.email }}
                    </div>

                    <!-- Phone -->
                    <div class="form-group">
                        <label for="{{ form.phoneno.id_for_label }}">{% trans "Phone Number" %}<span class="required-star">*</span></label>
                        {{ form.phoneno }}
                    </div>

                    <!-- Profile Photo -->
                    <div class="form-group">
                        <label for="{{ form.profile_photo.id_for_label }}">{% trans "Profile Photo" %}</label>
                        {{ form.profile_photo }}
                    </div>

                    <!-- Password -->
                    <div class="form-group password-field">
                        <label for="{{ form.password.id_for_label }}">{% trans "Password" %}<span class="required-star">*</span></label>
                        <div class="password-wrapper">
                            {{ form.password }}
                            <i class="bi bi-eye-slash-fill toggle-password" data-target="id_password"></i>
                        </div>
                        <div class="password-info">
                            <div id="password-rules" class="password-dropdown">
                                <div class="password-hint-header">
                                    <p>Password must meet the following requirements</p>
                                </div>
                                <ul>
                                    <li>8–20 characters</li>
                                    <li>1 uppercase (A–Z)</li>
                                    <li>1 lowercase (a–z)</li>
                                    <li>1 number (0–9)</li>
                                    <li>1 special (@, #, $, %, &amp;)</li>
                                    <li>No spaces</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="form-group password-field">
                        <label for="{{ form.confirm_password.id_for_label }}">{% trans "Confirm Password" %}<span class="required-star">*</span></label>
                        <div class="password-wrapper">
                            {{ form.confirm_password }}
                            <i class="bi bi-eye-slash-fill toggle-password" data-target="id_confirm_password"></i>
                        </div>

                        <div class="password-info">
                            <div id="confirm-password-rules" class="password-dropdown">
                                <div class="password-hint-header">
                                    <p>Confirm Password Requirement</p>
                                </div>
                                <ul>
                                    <li>Must match the password</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                </div>

                <button type="submit" class="btn-register">{% trans "Register" %}</button>
            </form>


            <!-- Django Message Framework -->
            <div class="error-container">

                <!-- General form errors -->
                {% if form.non_field_errors %}
                    {% for error in form.non_field_errors %}
                        <p class="form-error-message error">{{ error }}</p>
                    {% endfor %}
                {% endif %}
            
                <!-- Field-specific errors -->
                {% for field in form %}
                    {% for error in field.errors %}
                        <p class="form-error-message error">{{ error }}</p>
                    {% endfor %}
                {% endfor %}
            
                {% if messages %}
                    {% for message in messages %}
                        <p class="form-error-message {{ message.tags }}">{{ message }}</p>
                    {% endfor %}
                {% endif %}
            </div>
            
            

        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
      const passwordField = document.querySelector('input[name="password"]');
      const confirmPasswordField = document.querySelector('input[name="confirm_password"]');
      const passwordRulesBox = document.getElementById("password-rules");
      const confirmRulesBox = document.getElementById("confirm-password-rules");
      const passwordRules = passwordRulesBox.querySelectorAll("li");
      const confirmRule = confirmRulesBox.querySelector("li");
  
      const checks = [
        /.{8,20}/,
        /[A-Z]/,
        /[a-z]/,
        /\d/,
        /[!@#$%^&*(),.?":{}|<>]/,
        /^[^\s]+$/
      ];
  
      const showBox = (box) => { box.style.display = "block"; };
      const hideBox = (box) => { setTimeout(() => box.style.display = "none", 200); };
  
      passwordField.addEventListener("focus", () => showBox(passwordRulesBox));
      passwordField.addEventListener("blur", () => hideBox(passwordRulesBox));
      confirmPasswordField.addEventListener("focus", () => showBox(confirmRulesBox));
      confirmPasswordField.addEventListener("blur", () => hideBox(confirmRulesBox));
  
      passwordField.addEventListener("input", () => {
        const value = passwordField.value;
        checks.forEach((regex, index) => {
          if (regex.test(value)) {
            passwordRules[index].classList.add("valid");
            passwordRules[index].classList.remove("invalid");
          } else {
            passwordRules[index].classList.add("invalid");
            passwordRules[index].classList.remove("valid");
          }
        });
  
        if (confirmPasswordField.value !== "") {
          if (confirmPasswordField.value === passwordField.value) {
            confirmRule.classList.add("valid");
            confirmRule.classList.remove("invalid");
          } else {
            confirmRule.classList.add("invalid");
            confirmRule.classList.remove("valid");
          }
        }
      });
  
      confirmPasswordField.addEventListener("input", () => {
        if (confirmPasswordField.value === passwordField.value && passwordField.value !== "") {
          confirmRule.classList.add("valid");
          confirmRule.classList.remove("invalid");
        } else {
          confirmRule.classList.add("invalid");
          confirmRule.classList.remove("valid");
        }
      });
    });
  </script>
  
{% endblock %}


{% block scripts %}
<script src="{% static 'js/error_message.js' %}"></script>
{% endblock %}

