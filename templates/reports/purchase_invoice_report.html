{% extends 'base_admin.html' %}
{% load static i18n %}

{% block title %}{% trans "Sales Invoice Report" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin/purchase_report.css' %}">
<link rel="stylesheet" href="{% static 'css/admin/admin_report_table.css' %}">
{% endblock %}

{% block content %}
<div class="purchase-report-container">
    <!-- Header -->
    <div class="wh-header-section">
      <div class="wh-header-left">
          <h1><span>{% trans "Purchase " %}</span> {% trans "Invoice Report" %}</h1>
          <p class="subtext">
              {% trans "View and analyze all purchase invoices, vendors, and payment status." %}
          </p>
      </div>
      <div class="wh-header-right">
          <a href="{% url 'admin_reports' %}" class="btn-back">
              <i class="bi bi-arrow-left"></i> {% trans "Back" %}
          </a>
      </div>
  </div>

    <!-- Filter/Search -->
    <!-- Filter/Search -->
    <!-- Filter/Search -->
    <form method="GET" class="filter-form">
      <input
          type="text"
          name="search"
          placeholder="{% trans 'Search by Invoice No, Order No, Customer Name...' %}"
          value="{{ search_query }}"
      >

      <select name="status">
          <option value="">{% trans "All Statuses" %}</option>
          {% for s in statuses %}
              <option value="{{ s }}" {% if s == status_filter %}selected{% endif %}>
                  {{ s }}
              </option>
          {% endfor %}
      </select>

      <button type="submit">{% trans "Filter" %}</button>
  </form>

      <!-- Meta Info & Actions -->
      <div class="report-meta">
        <div class="report-meta-content-left">
            <span class="records-count">
                {% trans "Total Records:" %}
                <strong>{{ invoices|length }}</strong>
            </span>
            <span class="generated-date">
                <i class="bi bi-clock"></i>
                {% trans "Generated on:" %}
                {{ generated_on|date:"d M Y, H:i" }}
            </span>
        </div>

        <div class="report-meta-content-right">
            <a href="{% url 'purchase_invoice_report_excel' %}" class="action-btn excel">
                <i class="bi bi-file-earmark-excel"></i>
                {% trans "Download Excel" %}
            </a>
            <a href="{% url 'purchase_invoice_report_pdf' %}" class="action-btn pdf">
                <i class="bi bi-file-earmark-pdf"></i>
                {% trans "Download PDF" %}
            </a>
        </div>
    </div>

    <!-- Table -->
    <div class="table-scroll-wrapper">
      <div class="table-container">
          <table class="report-table" id="reportTable">
            <thead class="table-success">
              <tr>
                <th>Invoice No</th><th>Supplier</th><th>PO No</th>
                <th>Date</th><th>Subtotal</th><th>VAT</th><th>Total</th><th>Status</th>
              </tr>
            </thead>
            <tbody>
  {% for i in invoices %}
  <tr>
    <td>{{ i.invoice_no }}</td>
    <td>{{ i.supplier.supplier_name }}</td>
    <td>{{ i.purchase_order.order_no }}</td>
    <td>{{ i.invoice_date|date:"d-m-Y" }}</td>
<td>{{ i.subtotal|floatformat:2 }}</td>
<td>{{ i.vat_amount|floatformat:2 }}</td>
<td>{{ i.total_amount|floatformat:2 }}</td>

    <td>{{ i.status }}</td>
  </tr>
  {% empty %}
  <tr>
      <td colspan="8" class="no-data">
          {% trans "No purchase Invoices Found" %}
      </td>
  </tr>
  {% endfor %}
</tbody>

          </table>
      </div>
    </div>
      <!-- Pagination (same JS can be reused) -->
      <div class="pagination-container" id="tablePagination"></div>
</div>

{% endblock %}

{% block scripts %}
<script src="{% static 'js/admin/admin_report_tables.js' %}"></script>
{% endblock %}

