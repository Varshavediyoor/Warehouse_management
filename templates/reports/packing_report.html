{% extends 'base_admin.html' %}
{% load static i18n %}

{% block title %}{% trans "Packing Report" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin/purchase_report.css' %}">
<link rel="stylesheet" href="{% static 'css/admin/admin_report_table.css' %}">
{% endblock %}

{% block content %}
<div class="purchase-report-container">
  <!-- header  -->
  <div class="wh-header-section">
    <div class="wh-header-left">
        <h1><span>{% trans "Packing" %}</span> {% trans "Report" %}</h1>
        <p class="subtext">{% trans "Detailed summary of all packing slips and activities." %}</p>
    </div>
    <div class="wh-header-right">          
        <a href="{% url 'admin_reports' %}" class="btn-back">
            <i class="bi bi-arrow-left"></i> {% trans "Back" %}
        </a>
    </div>
  </div>

  <!-- Filter/Search -->
  <form method="GET" class="filter-form">
    <input type="text" name="search" placeholder="Search by Packing ID, Pick List No, Product, or Packer..." value="{{ search_query }}">
    <select name="status">
      <option value="">{% trans "All Status" %}</option>
<option value="PACKED" {% if status_filter == 'PACKED' %}selected{% endif %}>
  {% trans "Packed" %}
</option>
<option value="AWAITING_DISPATCH" {% if status_filter == 'AWAITING_DISPATCH' %}selected{% endif %}>
  {% trans "Awaiting Dispatch" %}
</option>

    </select>
    <button type="submit">{% trans "Filter" %}</button>
  </form>

  <div class="report-meta">
    <div class="report-meta-content-left">
      <span class="records-count">{% trans "Total Records:" %} <strong>{{ packings|length }}</strong></span>
      <span class="generated-date"><i class="bi bi-clock"></i> {% trans "Generated on:" %} {{ generated_on|date:"d M Y, H:i" }}</span>
    </div>

    <div class="report-meta-content-right">
      <a href="{% url 'packing_report_excel' %}" class="action-btn excel">
        <i class="bi bi-file-earmark-excel"></i>{% trans "Download Excel" %}
      </a>
      <a href="{% url 'packing_report_pdf' %}" class="action-btn pdf">
        <i class="bi bi-file-earmark-pdf"></i>{% trans "Download PDF" %}
      </a>
    </div>
  </div>
  <div class="table-scroll-wrapper">
      <div class="table-container">
        <table class="report-table" id="reportTable">
          <thead>
            <tr>
              <th>{% trans "Packing ID" %}</th>
              <th>{% trans "Pick List No" %}</th>
              <th>{% trans "Product / Batch" %}</th>
              <th>{% trans "Quantity Packed" %}</th>
              <th>{% trans "Packed By" %}</th>
              <th>{% trans "Packing Date" %}</th>
              <th>{% trans "Package Count" %}</th>
              <th>{% trans "Weight" %}</th>
              <th>{% trans "Status" %}</th>
            </tr>
          </thead>
<tbody>
{% for p in packings %}
<tr>
  <!-- Packing ID -->
  <td>{{ p.packing.id }}</td>

  <!-- Delivery Order No (instead of Pick List) -->
  <td>
    {{ p.packing.delivery_order.delivery_no|default:"-" }}
  </td>

  <!-- Product / Batch -->
  <td>
    {% if p.first_item %}
      {{ p.first_item.order_item.product.name }}
      {% if p.first_item.batch %}
        / {{ p.first_item.batch }}
      {% endif %}
    {% else %}
      -
    {% endif %}
  </td>

  <!-- Quantity Packed -->
  <td>
    {{ p.total_qty|default:"-" }}
  </td>

  <!-- Packed By -->
  <td>
    {{ p.packing.packed_by.username|default:"-" }}
  </td>

  <!-- Packing Date -->
  <td>
    {{ p.packing.packing_date|date:"d M Y" }}
  </td>

  <!-- Package Count -->
  <td>
    {{ p.box_count }}
  </td>

  <!-- Weight -->
  <td>
    {{ p.total_weight }} kg
  </td>

  <!-- Status -->
  <td>
    {% if p.packing.status == "PACKED" %}
      <span class="status-badge received">
        {{ p.packing.get_status_display }}
      </span>
    {% else %}
      <span class="status-badge pending">
        {{ p.packing.get_status_display }}
      </span>
    {% endif %}
  </td>
</tr>
{% empty %}
<tr>
  <td colspan="9" class="no-data">
    {% trans "No Packing Records Found" %}
  </td>
</tr>
{% endfor %}
</tbody>

        </table>
        <!-- Pagination Controls -->
        <div class="pagination-container" id="tablePagination"></div>
      </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/admin/admin_report_tables.js' %}"></script>
{% endblock %}