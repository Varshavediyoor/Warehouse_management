{% extends 'base_admin.html' %}
{% load static i18n %}

{% block title %}{% trans "Delivery Report" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin/purchase_report.css' %}">
<link rel="stylesheet" href="{% static 'css/admin/admin_report_table.css' %}">
{% endblock %}

{% block content %}
<div class="purchase-report-container">
    <!-- header  -->
    <div class="wh-header-section">
      <div class="wh-header-left">
          <h1><span>{% trans "Delivery" %}</span> {% trans "Report" %}</h1>
          <p class="subtext">{% trans "Comprehensive summary of all delivery activities and proofs." %}</p>
      </div>
      <div class="wh-header-right">          
          <a href="{% url 'admin_reports' %}" class="btn-back">
              <i class="bi bi-arrow-left"></i> {% trans "Back" %}
          </a>
      </div>
    </div>

  <!-- Filter/Search -->
  <form method="GET" class="filter-form">
    <input type="text" name="search" placeholder="Search by Delivery ID, Partner, Customer, or Status..." value="{{ search_query }}">
    <select name="partner">
      <option value="">{% trans "All Partners" %}</option>
      {% for p in partners %}
        <option value="{{ p }}" {% if p == partner_filter %}selected{% endif %}>{{ p }}</option>
      {% endfor %}
    </select>
    <select name="status">
      <option value="">{% trans "All Status" %}</option>
      {% for s in statuses %}
        <option value="{{ s }}" {% if s == status_filter %}selected{% endif %}>{{ s }}</option>
      {% endfor %}
    </select>
    <button type="submit">{% trans "Filter" %}</button>
  </form>

  <!-- Meta Info -->
  <div class="report-meta">
    <div class="report-meta-content-left">
      <span class="records-count">{% trans "Total Deliveries:" %} <strong>{{ deliveries|length }}</strong></span>
      <span class="generated-date"><i class="bi bi-clock"></i> {% trans "Generated on:" %} {{ generated_on|date:"d M Y, H:i" }}</span>
    </div>

    <div class="report-meta-content-right">
      <a href="{% url 'delivery_report_excel' %}" class="action-btn excel">
        <i class="bi bi-file-earmark-excel"></i>{% trans "Download Excel" %}
      </a>
      <a href="{% url 'delivery_report_pdf' %}" class="action-btn pdf">
        <i class="bi bi-file-earmark-pdf"></i>{% trans "Download PDF" %}
      </a>
    </div>
  </div>

  <!-- Table -->
  <div class="table-scroll-wrapper">
    <div class="table-container">
      <table class="report-table" id="reportTable">
        <thead>
          <tr>
            <th>{% trans "Delivery ID" %}</th>
            <th>{% trans "Dispatch / Picklist ID" %}</th>
            <th>{% trans "Delivery Partner" %}</th>
            <th>{% trans "Customer Name" %}</th>
            <th>{% trans "Delivery Date" %}</th>
            <th>{% trans "Proof of Delivery" %}</th>
            <th>{% trans "Status" %}</th>
            <th>{% trans "Remarks" %}</th>
          </tr>
        </thead>
        <tbody>
          {% if deliveries %}
            {% for d in deliveries %}
            <tr>
              <td>{{ d.delivery_id }}</td>
              <td>{{ d.dispatch_id }}</td>
              <td>{{ d.delivery_partner }}</td>
              <td>{{ d.customer_name }}</td>
              <td>{{ d.delivery_date|date:"d M Y" }}</td>
              <td>
                {% if d.proof_of_delivery and d.proof_of_delivery != "-" %}
                  <a href="{{ d.proof_of_delivery.url }}" target="_blank">{% trans "View" %}</a>
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                {% if d.status == "Pending" %}
                  <span class="status-badge pending">{{ d.status }}</span>
                {% elif d.status == "In Transit" %}
                  <span class="status-badge partial">{{ d.status }}</span>
                {% elif d.status == "Delivered" %}
                  <span class="status-badge received">{{ d.status }}</span>
                {% else %}
                  {{ d.status }}
                {% endif %}
              </td>
              <td>{{ d.remarks|default:"-" }}</td>
            </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="8" class="no-data">{% trans "No Delivery Records Found" %}</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
        <!-- Pagination Controls -->
        <div class="pagination-container" id="tablePagination"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/admin/admin_report_tables.js' %}"></script>
{% endblock %}
