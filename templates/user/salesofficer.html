{% extends 'base_user.html' %}
{% load static i18n %}

{% block title %}{% trans "Sales Dashboard" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/user/salesofficer/salesofficer.css' %}">
<link rel="stylesheet" href="{% static 'css/user_dashboard_table.css' %}">
{% endblock %}

{% block content %}

<div class="db-header">
  <h1><span>{% trans "Sales" %}</span> {% trans "Officer" %}</h1>
  <p>{% trans "Create Purchase Orders, Receive Stock (GRN), Manage Suppliers, and Auto-Create Batches" %}</p>
</div>

<div class="dashboard-layout">

  <!-- Left Section -->
  <div class="left-section">
    <div class="im-cards">
      <!-- Orders Today -->
      <div class="im-card fade-up">
        <div class="maint-card-bubble"></div>
        <div class="im-card-image">
          <img src="{% static 'images/orders-today.png' %}" alt="Orders Today">
        </div>
        <div class="im-info">
          <h4>{% trans "Orders Today" %}</h4>
          <p class="im-number">{{ orders_today|default:"0" }}</p>
          <span class="im-sub">{% trans "vs yesterday:" %} {{ orders_vs_yesterday|default:"0" }}</span>
        </div>
      </div>

      <!-- Open Orders -->
      <div class="im-card fade-up delay-1">
        <div class="maint-card-bubble"></div>
        <div class="im-card-image">
          <img src="{% static 'images/storekeeper1.png' %}" alt="Open Orders">
        </div>
        <div class="im-info">
          <h4>{% trans "Open Orders" %}</h4>
          <p class="im-number">{{ open_orders|default:"0" }}</p>
          <span class="im-sub">{% trans "Awaiting fulfillment:" %} {{ open_orders_pending|default:"0" }}</span>
        </div>
      </div>

      <!-- Delivered Orders -->
      <div class="im-card fade-up delay-2">
        <div class="maint-card-bubble"></div>
        <div class="im-card-image">
          <img src="{% static 'images/delivered.png' %}" alt="Delivered">
        </div>
        <div class="im-info">
          <h4>{% trans "Delivered" %}</h4>
          <p class="im-number">{{ delivered_orders|default:"0" }}</p>
          <span class="im-sub">{% trans "This week:" %} {{ delivered_week|default:"0" }}</span>
        </div>
      </div>

      <!-- Pending Deliveries -->
      <div class="im-card fade-up delay-2">
        <div class="maint-card-bubble"></div>
        <div class="im-card-image">
          <img src="{% static 'images/pending-shipments.png' %}" alt="Pending Deliveries">
        </div>
        <div class="im-info">
          <h4>{% trans "Pending Deliveries" %}</h4>
          <p class="im-number">{{ pending_deliveries|default:"0" }}</p>
          <span class="im-sub">{% trans "Scheduled today:" %} {{ delivery_today|default:"0" }}</span>
        </div>
      </div>

      <!-- Returns Raised -->
      <div class="im-card fade-up delay-2">
        <div class="maint-card-bubble"></div>
        <div class="im-card-image">
          <img src="{% static 'images/truck.png' %}" alt="Returns Raised">
        </div>
        <div class="im-info">
          <h4>{% trans "Returns Raised" %}</h4>
          <p class="im-number">{{ returns_raised|default:"0" }}</p>
          <span class="im-sub">{% trans "Pending inspection:" %} {{ returns_pending|default:"0" }}</span>
        </div>
      </div>

      <!-- Pending Payments -->
      <div class="im-card fade-up delay-2">
        <div class="maint-card-bubble"></div>
        <div class="im-card-image">
          <img src="{% static 'images/outstanding-payments.png' %}" alt="Pending Payments">
        </div>
        <div class="im-info">
          <h4>{% trans "Pending Payments" %}</h4>
          <p class="im-number">â‚¹ {{ pending_payments|default:"0" }}</p>
          <span class="im-sub">{% trans "Overdue invoices:" %} {{ overdue_invoices|default:"0" }}</span>
        </div>
      </div>
    </div>

        <!------------------- reponsive quick action buttons  ---------->

        <aside class="quick-actions responsive">
          <div class="quick-action-heading">
            <h3>{% trans "Quick Actions" %}</h3>
          </div>
          <div class="actions-grid">
            <!-- Django links as you already have -->
            {% if "Add Stock" in allowed_functions %}
              <a href="{% url 'warehouse_manager:add_stock' %}" class="action-button">{% trans "Add Stock" %}</a>
            {% endif %}
            {% if "View Stock" in allowed_functions %}
              <a href="{% url 'warehouse_manager:view_stock' %}" class="action-button">{% trans "View Stock" %}</a>
            {% endif %}
            {% if "View Sales Orders" in allowed_functions %}
              <a href="{% url 'warehouse_manager:sales_order_list' %}" class="action-button">{% trans "View Sales Orders" %}</a>
            {% endif %}
            {% if "View Picklist" in allowed_functions %}
              <a href="{% url 'warehouse_manager:picklist_list' %}" class="action-button">{% trans "View Picklist" %}</a>
            {% endif %}
            {% if "Create Sales Order" in allowed_functions %}
              <a href="{% url 'salesofficer:create_sales_order' %}" class="action-button">{% trans "Create Sales Order" %}</a>
            {% endif %}
            {% if "Sales Orders" in allowed_functions %}
              <a href="{% url 'salesofficer:list_sales_orders' %}" class="action-button">{% trans "Sales Orders" %}</a>
            {% endif %}
      
            {% if "Ready For Delivery" in allowed_functions %}
              <a href="{% url 'salesofficer:ready_for_delivery' %}" class="action-button">{% trans "Assign Delivery Boy" %}</a>
            {% endif %}
      
            {% if "Create Purchase Order" in allowed_functions %}
              <a href="{% url 'procurement_officer:purchaseorder_create' %}" class="action-button">{% trans "New Purchase Order" %}</a>
            {% endif %}
          
            {% if "View Purchase Order List" in allowed_functions %}
              <a href="{% url 'procurement_officer:purchaseorder_list' %}" class="action-button">{% trans "Purchase Order List" %}</a>
            {% endif %}
          
            {% if "Create GRN" in allowed_functions %}
              <a href="{% url 'procurement_officer:create_grn' %}" class="action-button">{% trans "Create GRN" %}</a>
            {% endif %}
          
            {% if "View GRN" in allowed_functions %}
              <a href="{% url 'procurement_officer:grn_list' %}" class="action-button">{% trans "View GRN" %}</a>
            {% endif %}
          
            {% if "Review GRN" in allowed_functions %}
              <a href="{% url 'grn_review_list' %}" class="action-button">{% trans "Review GRN" %}</a>
            {% endif %}
          
            {% if "View Delivery List" in allowed_functions %}
              <a href="{% url 'delivery_staff:all_deliveries' %}" class="action-button">{% trans "View Assigned Deliveries" %}</a>
            {% endif %}
        <!-- dummy buttons add here  -->
        <a href="#" class="action-button">{% trans "Check Stock Availability" %}</a>
        <a href="#" class="action-button">{% trans "Reverse Stock" %}</a>
        <a href="#" class="action-button">{% trans "View Invoice" %}</a>
        <a href="#" class="action-button">{% trans "Create Return Request" %}</a>
        <a href="#" class="action-button">{% trans "Sales Reports" %}</a>
          </div>
          <div class="quick-actions-img">
            <img src="{% static 'images/quick-actions.png' %}" alt="quick-actions-img">
          </div>
        </aside>

    <!-- Sales Funnel -->
    <section class="sales-funnel">
      <h2 class="funnel-section-title">Sales Funnel</h2>
      <p class="funnel-section-subtitle">Track order movement from creation to closure</p>
      <div class="funnel-wrapper">
        <div class="funnel-step {% if funnel_data.created > 0 %}completed{% endif %}">
          <span class="step-circle">1</span>
          <span class="step-label">Order Created</span>
        </div>
        <div class="funnel-line {% if funnel_data.packed > 0 %}completed{% endif %}"></div>
        <div class="funnel-step {% if funnel_data.packed > 0 %}completed{% endif %}">
          <span class="step-circle">2</span>
          <span class="step-label">Packed</span>
        </div>
        <div class="funnel-line {% if funnel_data.dispatched > 0 %}completed{% endif %}"></div>
        <div class="funnel-step {% if funnel_data.dispatched > 0 %}active{% endif %}">
          <span class="step-circle">3</span>
          <span class="step-label">Dispatched</span>
        </div>
        <div class="funnel-line {% if funnel_data.delivered > 0 %}completed{% endif %}"></div>
        <div class="funnel-step {% if funnel_data.delivered > 0 %}completed{% endif %}">
          <span class="step-circle">4</span>
          <span class="step-label">Delivered</span>
        </div>
        <div class="funnel-line {% if funnel_data.closed > 0 %}completed{% endif %}"></div>
        <div class="funnel-step {% if funnel_data.closed > 0 %}completed{% endif %}">
          <span class="step-circle">5</span>
          <span class="step-label">Closed</span>
        </div>
      </div>
    </section>

    <!-- Recent Activities -->
    <div class="recent-activities">
      <h2>{% trans "Recent Activities" %}</h2>
      <div class="dashboard-table-wrap">
        <div class="table-scroll">
          <table class="dashboard-table">
            <thead>
              <th>Activity</th>
              <th>Order</th>
              <th>Items / Value</th>
              <th>Status</th>
              <th>Time</th>
            </thead>
            <tbody>
              {% if recent_activities %}
                {% for activity in recent_activities %}
                  <tr>
                    <td>{{ activity.activity }}</td>
                    <td>{{ activity.order }}</td>
                    <td>{{ activity.items }}</td>
                    <td><span class="badge">{{ activity.status }}</span></td>
                    <td>{{ activity.time }}</td>
                  </tr>
                {% endfor %}
              {% else %}
                  <tr>
                    <td colspan="5" class="no-box">No Recent activities yet.</td>
                  </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div> <!-- Left Section End -->

  <!-- Right Section -->
  <!-- Right Section -->
  <div class="right-section">
    <aside class="quick-actions">
      <div class="quick-action-heading">
        <h3>{% trans "Quick Actions" %}</h3>
      </div>
      <div class="actions-grid">
        <!-- Django links as you already have -->
        {% if "Add Stock" in allowed_functions %}
          <a href="{% url 'warehouse_manager:add_stock' %}" class="action-button">{% trans "Add Stock" %}</a>
        {% endif %}
        {% if "View Stock" in allowed_functions %}
          <a href="{% url 'warehouse_manager:view_stock' %}" class="action-button">{% trans "View Stock" %}</a>
        {% endif %}
        {% if "View Sales Orders" in allowed_functions %}
          <a href="{% url 'warehouse_manager:sales_order_list' %}" class="action-button">{% trans "View Sales Orders" %}</a>
        {% endif %}
        {% if "View Picklist" in allowed_functions %}
          <a href="{% url 'warehouse_manager:picklist_list' %}" class="action-button">{% trans "View Picklist" %}</a>
        {% endif %}
        {% if "Create Sales Order" in allowed_functions %}
          <a href="{% url 'salesofficer:create_sales_order' %}" class="action-button">{% trans "Create Sales Order" %}</a>
        {% endif %}
        {% if "Sales Orders" in allowed_functions %}
          <a href="{% url 'salesofficer:list_sales_orders' %}" class="action-button">{% trans "Sales Orders" %}</a>
        {% endif %}

        {% if "Ready For Delivery" in allowed_functions %}
          <a href="{% url 'salesofficer:ready_for_delivery' %}" class="action-button">{% trans "Assign Delivery Boy" %}</a>
        {% endif %}

        {% if "Create Purchase Order" in allowed_functions %}
          <a href="{% url 'procurement_officer:purchaseorder_create' %}" class="action-button">{% trans "New Purchase Order" %}</a>
        {% endif %}
      
        {% if "View Purchase Order List" in allowed_functions %}
          <a href="{% url 'procurement_officer:purchaseorder_list' %}" class="action-button">{% trans "Purchase Order List" %}</a>
        {% endif %}
      
        {% if "Create GRN" in allowed_functions %}
          <a href="{% url 'procurement_officer:create_grn' %}" class="action-button">{% trans "Create GRN" %}</a>
        {% endif %}
      
        {% if "View GRN" in allowed_functions %}
          <a href="{% url 'procurement_officer:grn_list' %}" class="action-button">{% trans "View GRN" %}</a>
        {% endif %}
      
        {% if "Review GRN" in allowed_functions %}
          <a href="{% url 'grn_review_list' %}" class="action-button">{% trans "Review GRN" %}</a>
        {% endif %}
      
        {% if "View Delivery List" in allowed_functions %}
          <a href="{% url 'delivery_staff:all_deliveries' %}" class="action-button">{% trans "Delivery Orders" %}</a>
        {% endif %}
        <!-- dummy buttons add here  -->
        <a href="#" class="action-button">{% trans "Check Stock Availability" %}</a>
        <a href="#" class="action-button">{% trans "Reverse Stock" %}</a>
        <a href="#" class="action-button">{% trans "View Invoice" %}</a>
        <a href="#" class="action-button">{% trans "Create Return Request" %}</a>
        <a href="#" class="action-button">{% trans "Sales Reports" %}</a>
      </div>
      <div class="quick-actions-img">
        <img src="{% static 'images/quick-actions.png' %}" alt="quick-actions-img">
      </div>
    </aside>
  </div>

</div> <!-- dashboard-layout end -->

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/user/salesofficer.js' %}"></script>
{% endblock %}