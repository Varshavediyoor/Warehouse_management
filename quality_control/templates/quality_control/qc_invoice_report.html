<!DOCTYPE html>
<html>
<head>
  <title>QC Invoice Report</title>

  <style>
    body {
      font-family: Arial, sans-serif;
    }

    table {
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th, td {
      border: 1px solid #999;
      padding: 6px;
      text-align: center;
    }

    th {
      background: #f2f2f2;
    }

    img.qc-thumb {
      width: 80px;
      border: 1px solid #ccc;
      display: block;
      margin: auto;
    }

    button {
      padding: 4px 10px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<h2>QC Invoice Report</h2>

<h3>Invoice: {{ invoice_number }}</h3>

<!-- ✅ ADDED: DOWNLOAD PDF BUTTON (ONLY ADDITION) -->
<div style="margin-bottom:15px;">
  <a href="{% url 'qc_invoice_report_pdf' invoice_number %}"
     class="download-btn">
    ⬇ Download QC Report PDF
  </a>
</div>

{% for qc in inspections %}
  <hr>

  <h4>Item: {{ qc.product_name }}</h4>

  <!-- QC SUMMARY -->
  <table width="100%">
    <tr>
      <th>Category</th>
      <th>Received</th>
      <th>Approved</th>
      <th>Rejected</th>
      <th>Status</th>
    </tr>
    <tr>
      <td>{{ qc.category }}</td>
      <td>{{ qc.received_qty }}</td>
      <td>{{ qc.approved_qty }}</td>
      <td>{{ qc.rejected_qty }}</td>
      <td><b>{{ qc.status }}</b></td>
    </tr>
  </table>

  <h5>Checklist Details</h5>

  <!-- CHECKLIST TABLE -->
  <table width="100%">
    <tr>
      <th>#</th>
      <th>Checklist Item</th>
      <th>Pass</th>
      <th>Remarks</th>
      <th>Photo</th>
    </tr>

    {% for ans in qc.answers.all %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ ans.checklist_item.name }}</td>
      <td>{{ ans.answer|yesno:"Yes,No" }}</td>
      <td>{{ ans.remarks|default:"-" }}</td>
      <td>
        {% if ans.photo %}
          <img src="{{ ans.photo.url }}" class="qc-thumb">
          <br>
          <button type="button"
                  onclick="viewPhoto('{{ ans.photo.url }}')">
            View
          </button>
        {% else %}
          -
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>

{% endfor %}

<!-- ================= PHOTO MODAL ================= -->
<div id="photoModal"
     style="display:none;
            position:fixed;
            top:0; left:0;
            width:100%; height:100%;
            background:rgba(0,0,0,0.7);
            align-items:center;
            justify-content:center;
            z-index:9999;"
     onclick="closePhotoModal()">

  <div style="background:#fff;
              padding:10px;
              max-width:90%;
              max-height:90%;"
       onclick="event.stopPropagation()">

    <img id="modalImage"
         src=""
         style="max-width:100%;
                max-height:80vh;
                display:block;
                margin:auto;">

    <div style="text-align:center;margin-top:8px;">
      <button onclick="closePhotoModal()">Close</button>
    </div>
  </div>
</div>

<!-- ================= JS ================= -->
<script>
function viewPhoto(url) {
  const modal = document.getElementById("photoModal");
  const img = document.getElementById("modalImage");

  img.src = url;
  modal.style.display = "flex";
}

function closePhotoModal() {
  document.getElementById("photoModal").style.display = "none";
}
</script>

</body>
</html>
